import os
import pandas as pd
import matplotlib.pyplot as plt

# Directory containing the CSV files
directory_path = r"C:\Users\harry\Documents\R_to_excel\excel_files_5fish"
 
csv_files = sorted([filename for filename in os.listdir(directory_path) if filename.endswith(".csv")])

 
for filename in csv_files:
    if filename.endswith(".csv"):
        
        df = pd.read_csv(os.path.join(directory_path, filename))

        # Calculate the distance between the first fish and the other four fish for each frame
        closest_fish_count = [0, 0, 0, 0]

        for frame in range(len(df)):
            first_fish_displacement = df.iloc[frame, 2:4].values  # X and Y displacement of the first fish
            distances = []  # List to store distances between the first fish and other fish
            for i in range(1, 5):  
                other_fish_displacement = df.iloc[frame, 14*i+2:14*i+4].values  # X and Y displacement of the other fish
                distance = ((first_fish_displacement - other_fish_displacement) ** 2).sum() ** 0.5 
                distances.append(distance)
            closest_fish_index = distances.index(min(distances))  
            closest_fish_count[closest_fish_index] += 1  # Increment count for closest fish

        
        total_frames = len(df)
        proportion = [(count / total_frames) for count in closest_fish_count]

         
        plt.figure(figsize=(10, 8))

        plt.subplot(2, 1, 1)
        fish_labels = ["Fish 2", "Fish 3", "Fish 4", "Fish 5"]
        plt.bar(fish_labels, proportion)
        plt.ylabel("Proportion (%)")
        plt.title("Distance Rank")


        plt.subplot(2, 1, 2)
        for i in range(5):
            fish_displacement = df.iloc[:, 14*i+2:14*i+4]
            plt.plot(fish_displacement.iloc[:, 0], fish_displacement.iloc[:, 1], label=f"Fish {i+1}")
            # Denote the start of each fish's path
            plt.scatter(fish_displacement.iloc[0, 0], fish_displacement.iloc[0, 1], color='red', marker='o')

        
        plt.xlabel("X Displacement")
        plt.ylabel("Y Displacement")
        plt.title("Paths of 5 Fish")
        plt.legend()

        
        plt.tight_layout()
        plt.suptitle(f"Data from {filename}", y=1.05)  # Add a title for the entire plot
        plt.show()
